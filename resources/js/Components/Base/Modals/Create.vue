<template>
    <JetDialogModal :show="showModal" @close="close">
        <template #title>
            {{ title }}
            <hr class="my-4" />
        </template>

        <template #content>
            <form action="" v-if="!edit">
                <div v-for="(field, key) in rows" :key="key">
                    <div v-if="field.type === 'image' && field.create">
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <div class="py-2">
                                    <div class="col-span-6 sm:col-span-4">
                                        <!-- Profile Photo File Input -->
                                        <input
                                            type="file"
                                            class="hidden"
                                            :ref="field.field"
                                            @change="
                                                updatePhotoPreview(field.field)
                                            "
                                        />
                                        <JetLabel
                                            :for="field.field"
                                            :value="field.label"
                                        />
                                        <!-- Current Profile Photo -->
                                        <div
                                            class="mt-2"
                                            v-if="photoPreview[field.field]"
                                        >
                                            <img
                                                :src="photoPreview[field.field]"
                                                class="object-cover w-20 h-20 rounded-full"
                                            />
                                        </div>
                                        <div class="mt-2" v-else>
                                            <div v-if="form[field.field]">
                                                <img
                                                    :src="form[field.field]"
                                                    class="object-cover w-20 h-20 rounded-full"
                                                />
                                            </div>
                                        </div>

                                        <jet-secondary-button
                                            class="mt-2 mr-2"
                                            type="button"
                                            @click.prevent="
                                                selectNewPhoto(field.field)
                                            "
                                        >
                                            Select A New Photo
                                        </jet-secondary-button>

                                        <progress
                                            v-if="form.progress"
                                            :value="form.progress.percentage"
                                            max="100"
                                        >
                                            {{ form.progress.percentage }}%
                                        </progress>

                                        <JetInputError
                                            :message="errors[field.field]"
                                            class="mt-2"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div v-else>
                            <div class="py-2">
                                <div class="col-span-6 sm:col-span-4">
                                    <!-- Profile Photo File Input -->
                                    <input
                                        type="file"
                                        class="hidden"
                                        :ref="field.field"
                                        @change="
                                            updatePhotoPreview(field.field)
                                        "
                                    />
                                    <JetLabel
                                        :for="field.field"
                                        :value="field.label"
                                    />
                                    <!-- Current Profile Photo -->
                                    <div
                                        class="mt-2"
                                        v-if="photoPreview[field.field]"
                                    >
                                        <img
                                            :src="photoPreview[field.field]"
                                            class="object-cover w-20 h-20 rounded-full"
                                        />
                                    </div>
                                    <div class="mt-2" v-else>
                                        <div v-if="form[field.field]">
                                            <img
                                                :src="form[field.field]"
                                                class="object-cover w-20 h-20 rounded-full"
                                            />
                                        </div>
                                    </div>

                                    <jet-secondary-button
                                        class="mt-2 mr-2"
                                        type="button"
                                        @click.prevent="
                                            selectNewPhoto(field.field)
                                        "
                                    >
                                        Select A New Photo
                                    </jet-secondary-button>

                                    <progress
                                        v-if="form.progress"
                                        :value="form.progress.percentage"
                                        max="100"
                                    >
                                        {{ form.progress.percentage }}%
                                    </progress>

                                    <JetInputError
                                        :message="errors[field.field]"
                                        class="mt-2"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        v-else-if="field.type === 'switch' && field.create"
                        class="mt-2"
                    >
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />
                                <Toggle
                                    :name="field.field"
                                    :id="field.field"
                                    v-model="form[field.field]"
                                    class="block w-full mt-1"
                                />
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                        <div v-else>
                            <JetLabel :for="field.field" :value="field.label" />
                            <Toggle
                                :name="field.field"
                                :id="field.field"
                                v-model="form[field.field]"
                                class="block w-full mt-1"
                            />
                            <JetInputError
                                :message="errors[field.field]"
                                class="mt-2"
                            />
                        </div>
                    </div>
                    <div v-else-if="field.type === 'schema' && field.create">
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <div
                                    v-for="(input, index) in field.options"
                                    :key="index"
                                    class="mt-2"
                                >
                                    <JetLabel
                                        :for="input.field"
                                        :value="input.label"
                                    />
                                    <JetInput
                                        :id="input.field"
                                        v-model="form[field.field][input.field]"
                                        :type="input.type"
                                        class="block w-full mt-1"
                                        autofocus
                                    />
                                </div>
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                        <div v-else>
                            <div
                                v-for="(input, index) in field.options"
                                :key="index"
                                class="mt-2"
                            >
                                <JetLabel
                                    :for="input.field"
                                    :value="input.label"
                                />
                                <JetInput
                                    :id="input.field"
                                    v-model="form[field.field][input.field]"
                                    :type="input.type"
                                    class="block w-full mt-1"
                                    autofocus
                                />
                            </div>
                            <JetInputError
                                :message="errors[field.field]"
                                class="mt-2"
                            />
                        </div>
                    </div>
                    <div
                        v-else-if="
                            (field.type === 'datetime' ||
                                field.type === 'time' ||
                                field.type === 'date') &&
                            field.create
                        "
                    >
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />
                                <div class="my-2">
                                    <flat-pickr
                                        v-if="field.type === 'date'"
                                        v-model="form[field.field]"
                                        :config="{
                                            wrap: true, // set wrap to true only when using 'input-group'
                                            altInput: true,
                                            defaultHour: 12,
                                            locale: Arabic, // locale for this instance only
                                        }"
                                        placeholder="Select date"
                                        class="w-full p-3 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                    ></flat-pickr>
                                    <flat-pickr
                                        v-if="field.type === 'datetime'"
                                        v-model="form[field.field]"
                                        :config="{
                                            wrap: true, // set wrap to true only when using 'input-group'
                                            altInput: true,
                                            enableTime: true,
                                            enableSeconds: true,
                                            defaultHour: 12,
                                            locale: Arabic, // locale for this instance only
                                        }"
                                        placeholder="Select date and time"
                                        class="w-full p-3 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                    ></flat-pickr>
                                    <flat-pickr
                                        v-if="field.type === 'time'"
                                        v-model="form[field.field]"
                                        :config="{
                                            noCalendar: true,
                                            altInput: true,
                                            enableTime: true,
                                            enableSeconds: true,
                                            wrap: true, // set wrap to true only when using 'input-group'
                                            altInput: true,
                                            defaultHour: 12,
                                            locale: Arabic, // locale for this instance only
                                        }"
                                        placeholder="Select time"
                                        class="w-full p-3 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                    ></flat-pickr>
                                </div>
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                        <div v-else>
                            <JetLabel :for="field.field" :value="field.label" />
                            <div class="my-2">
                                <flat-pickr
                                    v-if="field.type === 'date'"
                                    v-model="form[field.field]"
                                    :config="{
                                        wrap: true, // set wrap to true only when using 'input-group'
                                        altInput: true,
                                        defaultHour: 12,
                                        locale: Arabic, // locale for this instance only
                                    }"
                                    placeholder="Select date"
                                    class="w-full p-3 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                ></flat-pickr>
                                <flat-pickr
                                    v-if="field.type === 'datetime'"
                                    v-model="form[field.field]"
                                    :config="{
                                        wrap: true, // set wrap to true only when using 'input-group'
                                        altInput: true,
                                        enableTime: true,
                                        enableSeconds: true,
                                        defaultHour: 12,
                                        locale: Arabic, // locale for this instance only
                                    }"
                                    placeholder="Select date and time"
                                    class="w-full p-3 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                ></flat-pickr>
                                <flat-pickr
                                    v-if="field.type === 'time'"
                                    v-model="form[field.field]"
                                    :config="{
                                        noCalendar: true,
                                        altInput: true,
                                        enableTime: true,
                                        enableSeconds: true,
                                        wrap: true, // set wrap to true only when using 'input-group'
                                        altInput: true,
                                        defaultHour: 12,
                                        locale: Arabic, // locale for this instance only
                                    }"
                                    placeholder="Select time"
                                    class="w-full p-3 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                ></flat-pickr>
                            </div>
                            <JetInputError
                                :message="errors[field.field]"
                                class="mt-2"
                            />
                        </div>
                    </div>
                    <div
                        class="mt-2"
                        v-else-if="field.type === 'relation' && field.create"
                    >
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />
                                <multiselect
                                    v-model="form[field.field]"
                                    :selectAll="true"
                                    :searchable="true"
                                    :options="field.options"
                                    :multiple="field.multi"
                                    :track-by="field.track_by_id"
                                    :label="field.track_by_name"
                                ></multiselect>
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                        <div v-else>
                            <JetLabel :for="field.field" :value="field.label" />
                            <multiselect
                                v-model="form[field.field]"
                                :selectAll="true"
                                :searchable="true"
                                :options="field.options"
                                :multiple="field.multi"
                                :track-by="field.track_by_id"
                                :label="field.track_by_name"
                            ></multiselect>
                            <JetInputError
                                :message="errors[field.field]"
                                class="mt-2"
                            />
                        </div>
                    </div>
                    <div
                        class="mt-2"
                        v-else-if="field.type === 'hasOne' && field.create"
                    >
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />
                                <multiselect
                                    v-model="form[field.field]"
                                    :selectAll="true"
                                    :searchable="true"
                                    :options="field.options"
                                    :multiple="field.multi"
                                    :track-by="field.track_by_id"
                                    :label="field.track_by_name"
                                ></multiselect>
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                        <div v-else>
                            <JetLabel :for="field.field" :value="field.label" />
                            <multiselect
                                v-model="form[field.field]"
                                :selectAll="true"
                                :searchable="true"
                                :options="field.options"
                                :multiple="field.multi"
                                :track-by="field.track_by_id"
                                :label="field.track_by_name"
                            ></multiselect>
                            <JetInputError
                                :message="errors[field.field]"
                                class="mt-2"
                            />
                        </div>
                    </div>
                    <div
                        class="mt-2"
                        v-else-if="field.type === 'select' && field.create"
                    >
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />

                                <multiselect
                                    v-if="multi"
                                    v-model="form[field.field]"
                                    :selectAll="true"
                                    :searchable="true"
                                    :options="field.options"
                                    :multiple="field.multi"
                                    :track-by="field.track_by_id"
                                    :label="field.track_by_name"
                                ></multiselect>
                                <multiselect
                                    v-else
                                    v-model="form[field.field]"
                                    :options="field.options"
                                ></multiselect>
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                        <div v-else>
                            <JetLabel :for="field.field" :value="field.label" />
                            <multiselect
                                v-if="multi"
                                v-model="form[field.field]"
                                :selectAll="true"
                                :searchable="true"
                                :options="field.options"
                                :multiple="field.multi"
                                :track-by="field.track_by_id"
                                :label="field.track_by_name"
                            ></multiselect>
                            <multiselect
                                v-else
                                v-model="form[field.field]"
                                :options="field.options"
                            ></multiselect>
                            <JetInputError
                                :message="errors[field.field]"
                                class="mt-2"
                            />
                        </div>
                    </div>
                    <div v-else-if="field.type === 'textarea' && field.create">
                        <div class="py-2" v-if="field.create">
                            <div v-if="field.reactive">
                                <div v-if="form[field.row]">
                                    <JetLabel
                                        :for="field.field"
                                        :value="field.label"
                                    />
                                    <textarea
                                        rows="5"
                                        :id="field.field"
                                        :name="field.field"
                                        v-model="form[field.field]"
                                        class="w-full p-4 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                        autofocus
                                    ></textarea>
                                    <JetInputError
                                        :message="errors[field.field]"
                                        class="mt-2"
                                    />
                                </div>
                            </div>
                            <div v-else>
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />
                                <textarea
                                    rows="5"
                                    :id="field.field"
                                    :name="field.field"
                                    v-model="form[field.field]"
                                    class="w-full p-4 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                    autofocus
                                ></textarea>
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                    </div>
                    <div v-else>
                        <div class="py-2" v-if="field.create">
                            <div v-if="field.reactive">
                                <div v-if="form[field.row]">
                                    <JetLabel
                                        :for="field.field"
                                        :value="field.label"
                                    />
                                    <JetInput
                                        v-if="field.type === 'icon'"
                                        :id="field.field"
                                        v-model="form[field.field]"
                                        type="text"
                                        class="block w-full mt-1"
                                        autofocus
                                    />
                                    <JetInput
                                        v-else
                                        :id="field.field"
                                        v-model="form[field.field]"
                                        :type="field.type"
                                        class="block w-full mt-1"
                                        autofocus
                                    />
                                    <JetInputError
                                        :message="errors[field.field]"
                                        class="mt-2"
                                    />
                                </div>
                            </div>
                            <div v-else>
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />
                                <JetInput
                                    v-if="field.type === 'icon'"
                                    :id="field.field"
                                    v-model="form[field.field]"
                                    type="text"
                                    class="block w-full mt-1"
                                    autofocus
                                />
                                <JetInput
                                    v-else
                                    :id="field.field"
                                    v-model="form[field.field]"
                                    :type="field.type"
                                    class="block w-full mt-1"
                                    autofocus
                                />
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                    </div>
                </div>
                <slot name="create"></slot>
            </form>
            <form action="" v-else>
                <div v-for="(field, key) in rows" :key="key">
                    <div v-if="field.type === 'image' && field.edit">
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <div class="py-2">
                                    <div class="col-span-6 sm:col-span-4">
                                        <!-- Profile Photo File Input -->
                                        <input
                                            type="file"
                                            class="hidden"
                                            :ref="field.field"
                                            @change="
                                                updatePhotoPreview(field.field)
                                            "
                                        />
                                        <JetLabel
                                            :for="field.field"
                                            :value="field.label"
                                        />
                                        <!-- Current Profile Photo -->
                                        <div
                                            class="mt-2"
                                            v-if="photoPreview[field.field]"
                                        >
                                            <img
                                                :src="photoPreview[field.field]"
                                                class="object-cover w-20 h-20 rounded-full"
                                            />
                                        </div>
                                        <div class="mt-2" v-else>
                                            <div v-if="form[field.field]">
                                                <img
                                                    :src="form[field.field]"
                                                    class="object-cover w-20 h-20 rounded-full"
                                                />
                                            </div>
                                        </div>

                                        <jet-secondary-button
                                            class="mt-2 mr-2"
                                            type="button"
                                            @click.prevent="
                                                selectNewPhoto(field.field)
                                            "
                                        >
                                            Select A New Photo
                                        </jet-secondary-button>

                                        <progress
                                            v-if="form.progress"
                                            :value="form.progress.percentage"
                                            max="100"
                                        >
                                            {{ form.progress.percentage }}%
                                        </progress>

                                        <JetInputError
                                            :message="errors[field.field]"
                                            class="mt-2"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div v-else>
                            <div class="py-2">
                                <div class="col-span-6 sm:col-span-4">
                                    <!-- Profile Photo File Input -->
                                    <input
                                        type="file"
                                        class="hidden"
                                        :ref="field.field"
                                        @change="
                                            updatePhotoPreview(field.field)
                                        "
                                    />
                                    <JetLabel
                                        :for="field.field"
                                        :value="field.label"
                                    />
                                    <!-- Current Profile Photo -->
                                    <div
                                        class="mt-2"
                                        v-if="photoPreview[field.field]"
                                    >
                                        <img
                                            :src="photoPreview[field.field]"
                                            class="object-cover w-20 h-20 rounded-full"
                                        />
                                    </div>
                                    <div class="mt-2" v-else>
                                        <div v-if="form[field.field]">
                                            <img
                                                :src="form[field.field]"
                                                class="object-cover w-20 h-20 rounded-full"
                                            />
                                        </div>
                                    </div>

                                    <jet-secondary-button
                                        class="mt-2 mr-2"
                                        type="button"
                                        @click.prevent="
                                            selectNewPhoto(field.field)
                                        "
                                    >
                                        Select A New Photo
                                    </jet-secondary-button>

                                    <progress
                                        v-if="form.progress"
                                        :value="form.progress.percentage"
                                        max="100"
                                    >
                                        {{ form.progress.percentage }}%
                                    </progress>

                                    <JetInputError
                                        :message="errors[field.field]"
                                        class="mt-2"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        v-else-if="
                            (field.type === 'datetime' ||
                                field.type === 'time' ||
                                field.type === 'date') &&
                            field.edit
                        "
                    >
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />
                                <div class="my-2">
                                    <flat-pickr
                                        v-if="field.type === 'date'"
                                        v-model="form[field.field]"
                                        :config="{
                                            wrap: true, // set wrap to true only when using 'input-group'
                                            altInput: true,
                                            defaultHour: 12,
                                            locale: Arabic, // locale for this instance only
                                        }"
                                        placeholder="Select date"
                                        class="w-full p-3 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                    ></flat-pickr>
                                    <flat-pickr
                                        v-if="field.type === 'datetime'"
                                        v-model="form[field.field]"
                                        :config="{
                                            wrap: true, // set wrap to true only when using 'input-group'
                                            altInput: true,
                                            enableTime: true,
                                            enableSeconds: true,
                                            defaultHour: 12,
                                            locale: Arabic, // locale for this instance only
                                        }"
                                        placeholder="Select date and time"
                                        class="w-full p-3 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                    ></flat-pickr>
                                    <flat-pickr
                                        v-if="field.type === 'time'"
                                        v-model="form[field.field]"
                                        :config="{
                                            noCalendar: true,
                                            altInput: true,
                                            enableTime: true,
                                            enableSeconds: true,
                                            wrap: true, // set wrap to true only when using 'input-group'
                                            altInput: true,
                                            defaultHour: 12,
                                            locale: Arabic, // locale for this instance only
                                        }"
                                        placeholder="Select time"
                                        class="w-full p-3 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                    ></flat-pickr>
                                </div>
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                        <div v-else>
                            <JetLabel :for="field.field" :value="field.label" />
                            <div class="my-2">
                                <flat-pickr
                                    v-if="field.type === 'date'"
                                    v-model="form[field.field]"
                                    :config="{
                                        wrap: true, // set wrap to true only when using 'input-group'
                                        altInput: true,
                                        defaultHour: 12,
                                        locale: Arabic, // locale for this instance only
                                    }"
                                    placeholder="Select date"
                                    class="w-full p-3 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                ></flat-pickr>
                                <flat-pickr
                                    v-if="field.type === 'datetime'"
                                    v-model="form[field.field]"
                                    :config="{
                                        wrap: true, // set wrap to true only when using 'input-group'
                                        altInput: true,
                                        enableTime: true,
                                        enableSeconds: true,
                                        defaultHour: 12,
                                        locale: Arabic, // locale for this instance only
                                    }"
                                    placeholder="Select date and time"
                                    class="w-full p-3 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                ></flat-pickr>
                                <flat-pickr
                                    v-if="field.type === 'time'"
                                    v-model="form[field.field]"
                                    :config="{
                                        noCalendar: true,
                                        altInput: true,
                                        enableTime: true,
                                        enableSeconds: true,
                                        wrap: true, // set wrap to true only when using 'input-group'
                                        altInput: true,
                                        defaultHour: 12,
                                        locale: Arabic, // locale for this instance only
                                    }"
                                    placeholder="Select time"
                                    class="w-full p-3 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                ></flat-pickr>
                            </div>
                            <JetInputError
                                :message="errors[field.field]"
                                class="mt-2"
                            />
                        </div>
                    </div>
                    <div
                        v-else-if="field.type === 'switch' && field.edit"
                        class="mt-2"
                    >
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />
                                <Toggle
                                    :name="field.field"
                                    :id="field.field"
                                    v-model="form[field.field]"
                                    class="block w-full mt-1"
                                />
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                        <div v-else>
                            <JetLabel :for="field.field" :value="field.label" />
                            <Toggle
                                :name="field.field"
                                :id="field.field"
                                v-model="form[field.field]"
                                class="block w-full mt-1"
                            />
                            <JetInputError
                                :message="errors[field.field]"
                                class="mt-2"
                            />
                        </div>
                    </div>
                    <div v-else-if="field.type === 'schema' && field.edit">
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <div
                                    v-for="(input, index) in field.options"
                                    :key="index"
                                    class="mt-2"
                                >
                                    <JetLabel
                                        :for="input.field"
                                        :value="input.label"
                                    />
                                    <JetInput
                                        :id="input.field"
                                        v-model="form[field.field][input.field]"
                                        :type="input.type"
                                        class="block w-full mt-1"
                                        autofocus
                                    />
                                </div>
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                        <div v-else>
                            <div
                                v-for="(input, index) in field.options"
                                :key="index"
                                class="mt-2"
                            >
                                <JetLabel
                                    :for="input.field"
                                    :value="input.label"
                                />
                                <JetInput
                                    :id="input.field"
                                    v-model="form[field.field][input.field]"
                                    :type="input.type"
                                    class="block w-full mt-1"
                                    autofocus
                                />
                            </div>
                            <JetInputError
                                :message="errors[field.field]"
                                class="mt-2"
                            />
                        </div>
                    </div>
                    <div
                        class="mt-2"
                        v-else-if="field.type === 'relation' && field.edit"
                    >
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />
                                <multiselect
                                    v-model="form[field.field]"
                                    :selectAll="true"
                                    :searchable="true"
                                    :options="field.options"
                                    :multiple="field.multi"
                                    :track-by="field.track_by_id"
                                    :label="field.track_by_name"
                                ></multiselect>
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                        <div v-else>
                            <JetLabel :for="field.field" :value="field.label" />
                            <multiselect
                                v-model="form[field.field]"
                                :selectAll="true"
                                :searchable="true"
                                :options="field.options"
                                :multiple="field.multi"
                                :track-by="field.track_by_id"
                                :label="field.track_by_name"
                            ></multiselect>
                            <JetInputError
                                :message="errors[field.field]"
                                class="mt-2"
                            />
                        </div>
                    </div>
                    <div
                        class="mt-2"
                        v-else-if="field.type === 'hasOne' && field.edit"
                    >
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />
                                <multiselect
                                    v-model="form[field.field]"
                                    :selectAll="true"
                                    :searchable="true"
                                    :options="field.options"
                                    :multiple="field.multi"
                                    :track-by="field.track_by_id"
                                    :label="field.track_by_name"
                                ></multiselect>
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                        <div v-else>
                            <JetLabel :for="field.field" :value="field.label" />
                            <multiselect
                                v-model="form[field.field]"
                                :selectAll="true"
                                :searchable="true"
                                :options="field.options"
                                :multiple="field.multi"
                                :track-by="field.track_by_id"
                                :label="field.track_by_name"
                            ></multiselect>
                            <JetInputError
                                :message="errors[field.field]"
                                class="mt-2"
                            />
                        </div>
                    </div>
                    <div
                        class="mt-2"
                        v-else-if="field.type === 'select' && field.edit"
                    >
                        <div v-if="field.reactive">
                            <div v-if="form[field.row]">
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />
                                <multiselect
                                    v-if="multi"
                                    v-model="form[field.field]"
                                    :selectAll="true"
                                    :searchable="true"
                                    :options="field.options"
                                    :multiple="field.multi"
                                    :track-by="field.track_by_id"
                                    :label="field.track_by_name"
                                ></multiselect>
                                <multiselect
                                    v-else
                                    v-model="form[field.field]"
                                    :options="field.options"
                                ></multiselect>
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                        <div v-else>
                            <JetLabel :for="field.field" :value="field.label" />
                            <multiselect
                                v-if="multi"
                                v-model="form[field.field]"
                                :selectAll="true"
                                :searchable="true"
                                :options="field.options"
                                :multiple="field.multi"
                                :track-by="field.track_by_id"
                                :label="field.track_by_name"
                            ></multiselect>
                            <multiselect
                                v-else
                                v-model="form[field.field]"
                                :options="field.options"
                            ></multiselect>
                            <JetInputError
                                :message="errors[field.field]"
                                class="mt-2"
                            />
                        </div>
                    </div>
                    <div v-else-if="field.type === 'textarea' && field.edit">
                        <div class="py-2" v-if="field.create">
                            <div v-if="field.reactive">
                                <div v-if="form[field.row]">
                                    <JetLabel
                                        :for="field.field"
                                        :value="field.label"
                                    />
                                    <textarea
                                        rows="5"
                                        :id="field.field"
                                        :name="field.field"
                                        v-model="form[field.field]"
                                        class="w-full p-4 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                        autofocus
                                    ></textarea>
                                    <JetInputError
                                        :message="errors[field.field]"
                                        class="mt-2"
                                    />
                                </div>
                            </div>
                            <div v-else>
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />
                                <textarea
                                    rows="5"
                                    :id="field.field"
                                    :name="field.field"
                                    v-model="form[field.field]"
                                    class="w-full p-4 pr-12 text-sm border-gray-200 rounded-lg shadow-sm"
                                    autofocus
                                ></textarea>
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                    </div>
                    <div v-else>
                        <div class="py-2" v-if="field.edit">
                            <div v-if="field.reactive">
                                <div v-if="form[field.row]">
                                    <JetLabel
                                        :for="field.field"
                                        :value="field.label"
                                    />
                                    <JetInput
                                        v-if="field.type === 'icon'"
                                        :id="field.field"
                                        v-model="form[field.field]"
                                        type="text"
                                        class="block w-full mt-1"
                                        autofocus
                                    />
                                    <JetInput
                                        v-else
                                        :id="field.field"
                                        v-model="form[field.field]"
                                        :type="field.type"
                                        class="block w-full mt-1"
                                        autofocus
                                    />
                                    <JetInputError
                                        :message="errors[field.field]"
                                        class="mt-2"
                                    />
                                </div>
                            </div>
                            <div v-else>
                                <JetLabel
                                    :for="field.field"
                                    :value="field.label"
                                />
                                <JetInput
                                    v-if="field.type === 'icon'"
                                    :id="field.field"
                                    v-model="form[field.field]"
                                    type="text"
                                    class="block w-full mt-1"
                                    autofocus
                                />
                                <JetInput
                                    v-else
                                    :id="field.field"
                                    v-model="form[field.field]"
                                    :type="field.type"
                                    class="block w-full mt-1"
                                    autofocus
                                />
                                <JetInputError
                                    :message="errors[field.field]"
                                    class="mt-2"
                                />
                            </div>
                        </div>
                    </div>
                </div>
                <slot name="edit"></slot>
            </form>
        </template>

        <template #footer>
            <button
                v-if="!edit"
                @click.prevent="saveRecord()"
                class="inline-flex items-center justify-center px-4 mr-2 font-medium tracking-tight text-white transition-colors border border-transparent rounded-lg shadow rtl:ml-2 focus:outline-none focus:ring-offset-2 focus:ring-2 focus:ring-inset filament-button dark:focus:ring-offset-0 h-9 focus:ring-white bg-primary-600 hover:bg-primary-500 focus:bg-primary-700 focus:ring-offset-primary-700 filament-page-button-action"
            >
                Save
            </button>
            <button
                v-else
                @click.prevent="updateRecord(form.id)"
                class="inline-flex items-center justify-center px-4 mr-2 font-medium tracking-tight text-white transition-colors border border-transparent rounded-lg shadow rtl:ml-2 focus:outline-none focus:ring-offset-2 focus:ring-2 focus:ring-inset filament-button dark:focus:ring-offset-0 h-9 focus:ring-white bg-primary-600 hover:bg-primary-500 focus:bg-primary-700 focus:ring-offset-primary-700 filament-page-button-action"
            >
                Update
            </button>
            <JetSecondaryButton @click="close"> Close </JetSecondaryButton>
        </template>
    </JetDialogModal>
</template>

<script>
import { defineComponent } from "vue";
import { Link } from "@inertiajs/inertia-vue3";
import JetDialogModal from "@/Jetstream/DialogModal.vue";
import JetSecondaryButton from "@/Jetstream/SecondaryButton.vue";
import JetButton from "@/Jetstream/Button.vue";
import JetInput from "@/Jetstream/Input.vue";
import JetInputError from "@/Jetstream/InputError.vue";
import JetLabel from "@/Jetstream/Label.vue";
import Multiselect from "@suadelabs/vue3-multiselect";
import Text from "@/Components/Base/Components/Text.vue";
import Switch from "@/Components/Base/Components/Switch.vue";
import Toggle from "@vueform/toggle";
import flatPickr from "vue-flatpickr-component";

export default defineComponent({
    components: {
        Link,
        JetDialogModal,
        JetSecondaryButton,
        JetButton,
        JetInput,
        JetInputError,
        JetLabel,
        Multiselect,
        Text,
        Switch,
        Toggle,
        flatPickr,
    },
    props: {
        show: Boolean,
        edit: Boolean,
        errors: Object,
        item: Object,
        title: String,
        url: String,
        rows: Array,
    },
    watch: {
        show(newValue, oldValue) {
            this.showModal = newValue;
        },
        item(newValue, oldValue) {
            this.form = newValue;
        },
    },
    data() {
        return {
            showModal: false,
            form: this.$inertia.form(this.item),
            photoPreview: {},
        };
    },
    methods: {
        close() {
            this.$emit("close", this.showModal);
        },
        success(id = null) {
            if (this.edit) {
                this.$emit("update", { form: this.form, id: id });
            } else {
                this.$emit("create", this.form);
            }
        },
        updatePhotoPreview(field) {
            const photo = this.$refs[field][0].files[0];

            if (!photo) return;

            const reader = new FileReader();

            reader.onload = (e) => {
                this.photoPreview[field] = e.target.result;
                this.form[field] = photo;
            };

            reader.readAsDataURL(photo);
        },
        selectNewPhoto(field) {
            this.$refs[field][0].click();
        },
        saveRecord() {
            this.form.submit("post", this.route(this.url + ".store"), {
                preserveScroll: true,
                onSuccess: () => {
                    this.form.reset();
                    this.$emit("success");
                },
            });
        },
        updateRecord(id) {
            this.form.submit("post", this.route(this.url + ".update", id), {
                preserveScroll: true,
                forceFormData: true,
                onSuccess: () => {
                    this.form.reset();
                    this.$emit("success");
                },
            });
        },
    },
});
</script>
